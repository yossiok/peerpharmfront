<html>
    <head>
        <title>Work Shift</title>
        <meta charset="windows-1255">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    
    <style>
	
	

.header{
	height: 45px;
	position: relative;
	background: #6E6E6E url(img03.jpg) top left no-repeat;
	padding: 45px;
	color: #FFFFFF;
	width: 1330px;
	border: solid 1px #7E7E7E;
	border-top-left-radius: 5px;
	border-top-right-radius: 5px;
	overflow: hidden;
	margin-left:20px
	

}

input[type=checkbox]{

	 transform: scale(1);
    -ms-transform: scale(1);
    -webkit-transform: scale(1.7);
    padding: 10px;
}

.header a1 {
	position: absolute;
    text-decoration: none;
	color: #FFFFFF;
	text-shadow: 0 1px 1px #3E3E3E;
	font-size:50px;
	align: right;
	bottom: 10;
    left: 15;
	
}

.ulMenu {
    list-style-type: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: linear-gradient(#209D9D, #497676) ;
	width: 1422px;
	margin-left:20px
}	

ul{
	background-color:white;
	cursor:pointer;
}
li {
   
}

li a, .dropbtn {
    display: inline-block;
    color: white;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
}

li a:hover, .dropdown:hover .dropbtn {
    background-color: red;
}

li.dropdown {
    display: inline-block;
	float: left;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}

.dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    text-align: left;
}

.dropdown-content a:hover {background-color: #f1f1f1}

.dropdown:hover .dropdown-content {
    display: block;
}



body{
	display:flex;
		min-height:30vh;
	align-items:center;
	justify-content:center;
	flex-direction:column;
}

#uploader{
	-webkit-appearance: none;
	appearance: none;
	width:50%;
	margin-bottom:10px;
	color:blue;
}

button{
	background-color:red;
	color: white;
	display: inline-block;
	font-size: 16px;
		margin: 4px 2px;
		cursor: pointer;
		 border: none;
}

.updateDateBtn{
  width: 120px;
  height: 24px;
  padding: 5px 16px 3px;
  -webkit-border-radius: 16px;
  -moz-border-radius: 16px;
  border: 2px solid #ccc;
  position: relative;
	
  /* Label */
  font-family: Lucida Sans, Helvetica, sans-serif;
  font-weight: 800;
  color: #fff;
  text-shadow: rgba(10, 10, 10, 0.5) 1px 2px 2px;
  text-align: center;
  vertical-align: middle;
  white-space: nowrap;
  text-overflow: ellipsis; 
  overflow: hidden;


}

tr{
	text-align:center;
}


 th {
    background: url(http://jackrugile.com/images/misc/noise-diagonal.png), linear-gradient(#777, #444);
    border-left: 1px solid #555;
    border-right: 1px solid #777;
    border-top: 1px solid #555;
    border-bottom: 1px solid #333;
    box-shadow: inset 0 1px 0 #999;
    color: #fff;
    font-weight: bold;
    padding: 10px 15px;
    position: relative;
    text-shadow: 0 1px 0 #000;  
}
.button2{

  height: 24px;
  padding: 5px 16px 3px;
  -webkit-border-radius: 16px;
  -moz-border-radius: 16px;
  border: 2px solid #ccc;
  position: relative;
	
  /* Label */
  font-family: Lucida Sans, Helvetica, sans-serif;
  font-weight: 800;
  color: #fff;
  text-shadow: rgba(10, 10, 10, 0.5) 1px 2px 2px;
  text-align: center;
  vertical-align: middle;
  white-space: nowrap;
  text-overflow: ellipsis; 
  overflow: hidden;
  cursor :pointer ;
  
}
.aqua{
  background-color: rgba(60, 132, 198, 0.8);
  background-image: -webkit-gradient(linear, 0% 0%, 0% 90%, from(rgba(28, 91, 155, 0.8)), to(rgba(108, 191, 255, .9)));
  border-top-color: #8ba2c1;
  border-right-color: #5890bf;
  border-bottom-color: #4f93ca;
  border-left-color: #768fa5;	
  -webkit-box-shadow: rgba(66, 140, 240, 0.5) 0px 10px 16px;
  -moz-box-shadow: rgba(66, 140, 240, 0.5) 0px 10px 16px; /* FF 3.5+ */
}
.button2 .glare {
  position: absolute;
  top: 0;
  left: 5px;
  -webkit-border-radius: 8px;
  -moz-border-radius: 8px;
  height: 1px;
  width: 142px;
  padding: 8px 0;
  background-color: rgba(255, 255, 255, 0.25);
  background-image: -webkit-gradient(linear, 0% 0%, 0% 95%, from(rgba(255, 255, 255, 0.7)), to(rgba(255, 255, 255, 0)));
  
}

.button{
	background-color:green;
	color: white;
	display: inline-block;
	font-size: 16px;
		margin: 4px 2px;
		cursor: pointer;
		 border: none;
}


td {
    border-right: 1px solid #fff;
    border-left: 1px solid #e8e8e8;
    border-top: 1px solid #fff;
    border-bottom: 1px solid #e8e8e8;
    position: relative;
    transition: all 300ms;
}




input[type=text] ,input[type=date], textarea
		{
		display: inline-block;
		-webkit-box-sizing: content-box;
		-moz-box-sizing: content-box;
		box-sizing: content-box;
		float: none;
		z-index: auto;
		width: 158px;
		height: auto;
		position: static;
		opacity: 1;
		margin: 0;
		//padding: 10px 20px;
		overflow: visible;
		border: 1px solid #b7b7b7;
		-webkit-border-radius: 3px;
		border-radius: 3px;
		font: normal medium/normal Arial, Helvetica, sans-serif;
		color: rgba(0,142,198,1);
		-o-text-overflow: clip;
		text-overflow: clip;
		background: rgba(252,252,252,1);
		-webkit-box-shadow: 2px 2px 2px 0 rgba(0,0,0,0.2) inset;
		box-shadow: 2px 2px 2px 0 rgba(0,0,0,0.2) inset;
		text-shadow: 1px 1px 0 rgba(255,255,255,0.66) ;
		-webkit-transition: all 200ms cubic-bezier(0.42, 0, 0.58, 1);
		-moz-transition: all 200ms cubic-bezier(0.42, 0, 0.58, 1);
		-o-transition: all 200ms cubic-bezier(0.42, 0, 0.58, 1);
		transition: all 200ms cubic-bezier(0.42, 0, 0.58, 1);
		-webkit-transform: none;
		transform: none;
		-webkit-transform-origin: 50% 50% 0;
		transform-origin: 50% 50% 0;
}
.btnImage{
	 width:25px;
	 height:25px;
	 float: right; 
	 cursor:pointer; 
	 margin:0	
	 


}

@media print
{
  table { page-break-after:auto }
  tr    { page-break-inside:avoid; page-break-after:auto }
  td    { page-break-inside:avoid; page-break-after:auto }
  thead { display:table-header-group }
  tfoot { display:table-footer-group }
}


</style>

<script src="https://www.gstatic.com/firebasejs/3.6.4/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDEsyNWFfPRXgrJonRwFc_1IZbHw3_7lxI",
    authDomain: "qualitycontrol-e60d4.firebaseapp.com",
    databaseURL: "https://qualitycontrol-e60d4.firebaseio.com",
    storageBucket: "qualitycontrol-e60d4.appspot.com",
    messagingSenderId: "428562253132"
  };
  firebase.initializeApp(config);
</script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js" ></script>
		<script>


		var firebaseRef = firebase.database().ref();
		var ordersRef =firebaseRef.child("orders");
		var scheduleRef= firebaseRef.child("schedulePrint");
		
		function init(){
			
			
				var pstn="";
				var statusColor="";
			//scheduleRef.orderByChild("status").equalTo("open").on("child_added", snap=>{
			$.getJSON("/printSchedule", (data)=>{
				console.log(data);	
				for(let i=0; i<data.length; i++){
						var refParent =  data[i]._id;
						var color = data[i].color;
						var qty = data[i].qty;
						var date = data[i].date;
						var item  = data[i].itemN;
						var orderN = data[i].orderN;
						var costumer = data[i].costumer;
						var productName = data[i].productName;
						var componentN = data[i].componentN;
						var cmptName = data[i].cmptName;
						var qtyProduced = data[i].qtyProduced;
						var marks = data[i].marks;
						var block = data[i].block;
						var nextStation = data[i].nextStation;
						var printType = data[i].printType;
						var pstn = data[i].position;
						if (pstn==null) pstn='';
						$("#table_body").append("<tr id='id_tr"+i+"' style='background-color:"+statusColor+"'><td><input type='text' id='inputPstnId"+i+"'  value='"+pstn+"' style='width:22px; text-align:center;' onfocusout='updatePosition("+i+ ", \"" +refParent+ "\")'></td><td>" + orderN +	 "</td><td>"+ item + "</td><td>" + costumer + "</td><td>" + componentN + 
										"</td><td>"+cmptName+"</td><td>"+ color + "</td><td>"+ qty + "</td><td>"+qtyProduced+"</td><td>"+ date + "</td><td>"+ nextStation + "</td><td>"+marks+"</td><td>"+printType+"</td><td>"+block+"</td><td><img src='/images/deleteBtn.png' style='width:40px' class='imgEd' onClick='deleteData(\"" +refParent+ "\")'><img id='editData"+i+"' src='/images/editBtn.png' style='width:40px; background-color:none' class='imgEd' onClick='editData("+i+ ", \"" +refParent+ "\")'><img id='editData"+i+"' src='/images/aproved.png' style='width:30px; background-color:none; margin-bottom:6px' class='imgEd' onClick='donePrinting(\"" +refParent+ "\")'></td></tr>");
					
				}});


			
			
		
		
		}

		function donePrinting(key){
		
		
		var amountPrinted = prompt("Enter Amount Printed", "");
		var amountPckgs = prompt("Enter Amount pf packages", "");  //for print sticker later
		if (amountPrinted == null || amountPrinted == "" || amountPckgs == null || amountPckgs == "") {
			
		} else {
			console.log(amountPckgs +  " , "  + amountPrinted);
		}
	
			var tempItem, tempOrderN, itemRemarks="";
			var a=confirm("Print process is done ?");
			if (a==true){
					
					
				scheduleRef.child(key).update({
					status:'print',
				});
					
					
					/////
					
				scheduleRef.child(key).on('value', snap=>{
						tempItem  = snap.child("itemN").val();
						tempOrderN = snap.child("orderN").val();
						itemRemarks = snap.child("itemRemarks").val();
						if (itemRemarks==null){
						 itemRemarks="";
						}
						console.log(tempOrderN +  " , "  + tempItem + " , " + itemRemarks);
						});
				ordersRef.child(tempOrderN).child(tempItem).update({
							itemRemarks: amountPrinted + ' Component printed, '+itemRemarks,
				})	 
					
				
				init();
					
					
					
				}
		
		
		}


		function enterNewPrinting(){
			color =  document.getElementById('color_id').value;
			qty =  document.getElementById('qty_id').value;
			itemN = document.getElementById('item_id').value;
			costumer =  document.getElementById('costumer_id').value;
			componentN =  document.getElementById('cmpt_id').value;
			cmptName =  document.getElementById('cmptName_id').value;
			marks =  document.getElementById('rmks_id').value;
			nextStation =  document.getElementById('nextStation_id').value;
			printType =  document.getElementById('printType_id').value;
			block =  document.getElementById('pallet_id').value;
			dateIs =  document.getElementById('date_id').value;
			
			if (dateIs==""){
				alert("Please Insert Date");
			}
			
			else{
					var _dt = new Date(dateIs);
					dateDMY=  [_dt.getDate(), _dt.getMonth()+1, _dt.getFullYear()].join('/');
					console.log("date is: "  + dateDMY, _dt);
					let newPrinting={					
						color:color,
						qty: qty,
						date: dateDMY,
						itemN:itemN,
						orderN:'',
						costumer:costumer,
						componentN:componentN,
						cmptName:cmptName,
						qtyProduced: '0',
						marks:marks,
						block:  block,
						nextStation:  nextStation,
						printType:printType,
						status:'open',
						positionN:'',
						
				}; 

				$.post('/printSchedule/add', 
				newPrinting,
					  function(data){	 
						console.log(data._id);
						$("#table_body").append("<tr id='id_tr"+i+"' style='background-color:"+statusColor+"'><td><input type='text' id='inputPstnId"+i+"'  value='"+pstn+"' style='width:22px; text-align:center;' onfocusout='updatePosition("+i+ ", \"" +refParent+ "\")'></td><td>" + orderN +	 "</td><td>"+ item + "</td><td>" + costumer + "</td><td>" + componenetN + 
										"</td><td>"+cmptName+"</td><td>"+ color + "</td><td>"+ qty + "</td><td>"+qtyProduced+"</td><td>"+ date + "</td><td>"+ nextStation + "</td><td>"+marks+"</td><td>"+printType+"</td><td>"+block+"</td><td><img src='/images/deleteBtn.png' style='width:40px' class='imgEd' onClick='deleteData(\"" +refParent+ "\")'><img id='editData"+i+"' src='/images/editBtn.png' style='width:40px; background-color:none' class='imgEd' onClick='editData("+i+ ", \"" +refParent+ "\")'><img id='editData"+i+"' src='/images/aproved.png' style='width:30px; background-color:none; margin-bottom:6px' class='imgEd' onClick='donePrinting(\"" +data._id	+ "\")'></td></tr>");
					});
				console.log(newPrinting);
			$('#color_id').val("");
			$('#qty_id').val("");
			$('#item_id').val("");
			$('#costumer_id').val("");
			$('#cmptName_id').val("");
			$('#rmks_id').val("");
			$('#nextStation_id').val("");
			$('#printType_id').val("");
			$('#pallet_id').val("");
			$('#date_id').val();
			init(); 
			}
				
		
		
		}


		function deleteData(key){
			
			var a=confirm("Delete order " +key + "?");
				if (a==true){
				let deletePrint = {
					req:'delete', 
					id: key,
				}
				$.post('/printSchedule/update', 
				deletePrint,
					  function(data){
					  console.log(data)	;
				});
			}
		i=0;
		init();
	}

	function showPallet(palletNumber, key){
		
		$("#myModal").css('display', 'block');	
		$("#showPN").html(palletNumber);
						console.log(key);

		palletRef.orderByChild("palletNumber").equalTo(palletNumber).on("child_added", snap=>{
			var img = snap.child('palletImg').val();
			
			$("#showImgPallet").attr('width','1200px');
			$("#showImgPallet").attr('src',img);
			var lastUpdate = snap.child('lastUpdate').val();
			console.log(snap.key);
		});
		
		
	
	}
	
	
	function updatePosition(i,key){
		
		//console.log(i + " , "  +key + "  , " + value);
		
		var pstnNewValue = document.getElementById("inputPstnId"+i).value;
		pstnNewValue = pstnNewValue.replace(/\s/g, '');  //remove sapcing
		let newPstn = {
			position:pstnNewValue,
			req:'updatePosition', 
			id: key,
		}
		$("#inputPstnId"+i).val(pstnNewValue);
		$.post('/printSchedule/update', 
				newPstn,
					  function(data){
					  console.log(data)	;
			});
		
	}
	
	function searchCmpt(){
		cmpt = $("#cmpt_id").val();
		console.log(cmpt);
		$.getJSON("/component?componentN="+cmpt , (data)=>{
			componentName=data[0].componentName;
			$("#cmptName_id").val(componentName);
		});
	}
		</script>
		
<body onload="init()" id='body' style='padding-top:20px'> 
    
  	
		 <a>
         
        <div class='header' style="width: 1330px ; height: 70px" id='headerDiv'><a1>Printing</a1> <img src="peerpharm.png"  width='270px' align='right'></div>
		<ul class="ulMenu">
			  <li style='float: left;'><a href="#home">Home</a></li>
			  <li class="dropdown">
				<a href="javascript:void(0)" class="dropbtn">Orders</a>
					<div class="dropdown-content">
					  <a href="openOrders.html">Open Orders</a>
					  <a href="newOrder.html">New Order</a>
					  <a href="showOrder.html">Search Order</a>
					  <a href="ordersList.html">All Orders</a>
					  
					</div>
			  </li>
			  <li class="dropdown">
				<a href="javascript:void(0)" class="dropbtn">Schedule</a>
					<div class="dropdown-content">
					  <a href="workShift.html">Work Schedule</a>
					  <a href="printing.html">Print Schedule</a>
					  
					</div>
			  </li>
			  <li class="dropdown">
			  <a href="javascript:void(0)" class="dropbtn">Items</a>
			  <div class="dropdown-content">
				<a href="itemsList.html">Items List</a>
				<a href="getItem.html">Product Tree</a>
				<a href="needToBuild.html">No Data List</a>
				</div>
				</li>
			  <li style='float: left;'><a href="costumers.html">Costumers</a></li>
			  <li style='float: left;'><a href="needToBuild.html">No Data List</a></li>
			  <li class="dropdown">
					<a href="javascript:void(0)" class="dropbtn">Batches</a>
					<div class="dropdown-content">
						<a href="batchesList.html">Cosmetics</a>
						<a href="batchesList_makeUp.html">Make Up</a>
					</div>
			  </li>
			  <li style='float: left;'><a href="forms.html">Forms</a></li>
			  
			  
		</ul>
		</a>
		<br><br>
		
		<table border="1">
            <thead>
            <tr align='center' bgcolor="silver">
                <th><b>P</b></th>
                <th><b>Order</b></th>
                <th><b>Item</b></th>
				 <th><b>Costumer</b></th>
                <th><b>Component Number</b></th>
                <th><b>Component Discription</b></th>
                <th><b>Color</b></th>
                <th colspan=2><b>Qty</b></th>
                <th><b>Date</b></th>
                <th><b>Next Station</b></th>
                <th><b>Remarks</b></th>
                <th><b>Type</b></th>
				<th>Image</th>
				<th></th>
            </tr> 
			<tr>
				<td></td>
				<td></td>
				<td><input type='text' id='item_id' style='width:90px'></td>
				<td><input type='text' id='costumer_id'></td>
				<td><input type='text' id='cmpt_id' style='width:90px' onfocusout='searchCmpt()'></td>
				<td><input type='text' id='cmptName_id' style='width:320px' ></td>
				<td><input type='text' id='color_id' style='width:90px'></td>
				<td colspan=2><input type='text' id='qty_id' style='width:90px'></td>
				<td><input type='date' id='date_id' style='width:140px'></td>
				<td>
					<select id='nextStation_id'>
						<option value='mkp'>איפור</option>
						<option value='prd'>ייצור</option>
						<option value='pkg'>אריזה</option>
					</select>
				</td></td>
				<td><input type='text' id='rmks_id'></td>
				<td>
					<select id='printType_id'>
						<option value='round'>שטוח</option>
						<option value='flat'>מעגלי</option>
					</select>
				</td>
				<td>
					<input type='number' id='pallet_id' style='width:50px'>
				</td>
				<td>
					<button onclick = 'enterNewPrinting()'>אישור</button>
				</td>
			</tr>
            </thead>
			
			  <tbody id="table_body">
                
            </tbody>
