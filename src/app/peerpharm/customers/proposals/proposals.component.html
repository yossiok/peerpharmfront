<div *ngIf="!authorized">אינך מורשה לראות מסך זה</div>
<div dir="rtl" *ngIf="authorized">
  <form [formGroup]="newProposalForm" class="form_1">
    <div class="row mt-2">
      <div class="col-1"></div>
      <div class="col-6"><h3>פרטי הלקוח</h3></div>
      <div class="col-2">
        <label>מתאריך</label>
        <input
          type="date"
          class="form-control"
          formControlName="proposalDate"
          [value]="currentDate | date: 'YYYY-MM-dd'"
        />
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-1"></div>
      <div class="col-2">
        <label>מספר הלקוח</label>
        <input
          type="text"
          class="form-control"
          formControlName="customerId"
          (blur)="getCustomerByNumber()"
        />
      </div>
      <div class="col-4">
        <label>שם הלקוח</label>
        <input
          class="form-control"
          type="select"
          list="customers"
          formControlName="customerName"
          (change)="getCustomerByName()"
        />
        <datalist id="customers">
          <option value="null" disabled>בחר לקוח</option>
          <ng-container *ngIf="allCustomersList.length > 0">
            <option
              *ngFor="let customer of allCustomersList"
              [value]="customer.costumerName"
            >
              {{ customer.costumerId }} - {{ customer.costumerName }}
            </option>
          </ng-container>
        </datalist>
      </div>

      <div class="col-2">
        <label>ארץ יעד</label>
        <select formControlName="country" class="form-control">
          <option disabled value="null">בחר יעד</option>
          <option value="israel">Israel - ישראל</option>
          <option value="abroad">Abroad - חו"ל</option>
        </select>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-1"></div>
      <div class="col-3">
        <label>שם הסוכן</label>
        <select class="form-control" formControlName="agent">
          <option value="null" disabled>בחר סוכן</option>
          <option
            [value]="agent.firstName + ' ' + agent.lastName"
            *ngFor="let agent of allUsers"
          >
            {{ agent.firstName }} {{ agent.lastName }}
          </option>
        </select>
      </div>
      <div class="col-1"></div>
      <div class="col-2">
        <label>מחירון:</label>
        <input
          class="form-control"
          type="text"
          formControlName="priceList"
          [value]="currentCustomer.costumerId"
        />
      </div>
      <div class="col-2">
        <label>מטבע</label>
        <select class="form-control" formControlName="currency">
          <option value="null" disabled>בחר מטבע</option>
          <option
            [value]="currency.name"
            *ngFor="let currency of allCurrencies"
          >
            {{ currency.name }}
          </option>
        </select>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-1"></div>
      <div class="col-6">
        <label> כתובת למשלוח:</label>
        <textarea
          name=""
          id=""
          cols="30"
          rows="3"
          class="form-control"
          formControlName="shippingAddress"
        ></textarea>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-1"></div>
      <div class="col-6">
        <label> כתובת חשבונית:</label>
        <textarea
          colls="30"
          rows="3"
          class="form-control"
          formControlName="invoiceAddress"
        ></textarea>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-1"></div>
      <div class="col-8">
        <table class="table striped">
          <thead>
            <tr>
              <th>#</th>
              <th>שם איש קשר</th>
              <th>טלפון</th>
              <th>אימייל</th>
              <th>
                <i
                  class="fa fa-plus text-success click"
                  ngbTooltip="New Contact"
                  (click)="addContact()"
                ></i>
              </th>
            </tr>
          </thead>
          <tbody>
            <ng-container formArrayName="contacts">
              <tr *ngFor="let contactForm of contacts.controls; let i = index">
                <ng-container [formGroup]="contactForm">
                  <td>{{ i + 1 }}</td>
                  <td *ngIf="i == editContact">
                    <input
                      type="text"
                      formControlName="name"
                      value="{{ contactForm.value.name }}"
                    />
                  </td>
                  <td *ngIf="i != editContact">{{ contactForm.value.name }}</td>
                  <td *ngIf="i != editContact">
                    {{ contactForm.value.phone }}
                  </td>
                  <td *ngIf="i == editContact">
                    <input
                      type="text"
                      formControlName="phone"
                      value="{{ contactForm.value.phone }}"
                    />
                  </td>
                  <td *ngIf="i != editContact">{{ contactForm.value.mail }}</td>
                  <td *ngIf="i == editContact">
                    <input
                      type="text"
                      formControlName="mail"
                      value="{{ contactForm.value.mail }}"
                    />
                  </td>
                  <td *ngIf="i != editContact">
                    <i
                      class="fa fa-pencil-alt text-primary click"
                      ngbTooltip="Edit contact"
                      (click)="editContact = i"
                    ></i
                    >&nbsp;&nbsp;
                    <i
                      class="fa fa-trash text-danger"
                      ngbTooltip="Delete contact"
                      (click)="removeContact(i)"
                    ></i>
                  </td>
                  <td *ngIf="i == editContact">
                    <i
                      class="fa fa-save text-success click"
                      ngbTooltip="Save"
                      (click)="saveContact(i, $event)"
                    >
                      &nbsp;</i
                    >
                    <i
                      class="fa fa-arrow-left text-danger click"
                      ngbTooltip="Clear"
                      (click)="clearContact(i)"
                    ></i>
                  </td>
                </ng-container>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-1"></div>
      <div class="col-2">
        <button class="btn btn-info" (click)="createProposal()">
          אשר והמשך
        </button>
      </div>
      <div class="col-4"></div>
      <div class="col-2">
        <button class="btn btn-danger" (click)="resetForm()">בטל ונקה</button>
      </div>
    </div>
  </form>
</div>
