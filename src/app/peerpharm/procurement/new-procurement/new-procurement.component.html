<!--UPDATE-->
<div *ngIf="purchaseData" style="border-radius: 15px;" class="container1 bg-white border shadow-lg text-center p-3">
  <div class="row">
    <div class="col-12 p-3">
      <form [formGroup]="newPurchase">
        <div class="row mt-3">
          <div class="col-3">
          </div>
          <div class="col-6">
            <h3 class="p-2">Purchase {{purchaseData.orderNumber}}</h3>
            <h3 class="p-2">{{purchaseData.supplierName}}</h3>
            <h4 class="p-2">{{purchaseData.supplierEmail}}</h4>
          </div>
          <div class="col-3">
            <h4>{{purchaseData.creationDate | date:'dd/MM/yy'}} &nbsp;&nbsp;
              <i class="fas fa-arrow-right"></i>&nbsp;&nbsp;
              <span *ngIf="purchaseData.arrivalDate && purchaseData.arrivalDate != purchaseData.creationDate" class="click"
                (click)="editArrivalDateForPurchase = !editArrivalDateForPurchase">{{purchaseData.arrivalDate |
                date:'dd/MM/yy'}}</span>
              <span *ngIf="!purchaseData.arrivalDate || purchaseData.arrivalDate == purchaseData.creationDate" class="click"
                (click)="editArrivalDateForPurchase = !editArrivalDateForPurchase"><button class="btn btn-primary">Set
                  Arrival Date</button></span>
            </h4>
            <h4 *ngIf="editArrivalDateForPurchase">
              <input type="date" formControlName="arrivalDate">
            </h4>
          </div>
        </div>
        <div class="row"></div>

        <div class="row">
          <div class="col-2">
            <button class="btn btn-primary rounded-pill form-control" (click)="open(recieveDeliveryCertificate)">
              New Certificate</button>
          </div>
          <div class="col-2">
            <button (click)="open(receiveInvoice)" class="btn btn-primary rounded-pill form-control">New
              Invoice</button>
          </div>
          <div class="col-5">
            <button class="btn btn-warning rounded-pill" (click)="open(sumShipping)">הזן נתוני העמסה</button>
          </div>
          <div class="col-2">
            <button *ngIf="editPurchaseAllowed" (click)="disabled = false"
              class="btn btn-warning rounded-pill form-control">Edit
              Purchase</button>
          </div>
          <div class="col-1">
            <i (click)="closeOrderModal.emit(false); selectedItems = []"
              class="click fa fa-times text-primary h2 close"></i>
          </div>
        </div>
        <div class="row mt-2">
          <div class="col-4">
            <button (click)="open(certAndInvModal)" class="btn btn-primary rounded-pill form-control">Watch
              Certificates & Invoices</button>
          </div>
          <div class="col-5">
          </div>
          <div class="col-2">
            <select *ngIf="editPurchaseAllowed" [disabled]="disabled" (change)="setPurchaseStatus($event)"
              class="form-control rounded-pill">
              <option selected="true" disabled="disabled">Choose Status</option>
              <option value="approvedBySupplier">approved</option>
              <option value="waitingForApproval">waiting approval</option>
              <option value="open">open</option>
              <option value="supplied">delivered</option>
              <option [style.background]="'red'" value="closed">Close Order</option>
            </select>
          </div>
          <div class="col-1"></div>
        </div>


        <div class="row mt-4">
          <div class="col-4"></div>
          <div class="col-4">
            <h5 class="text-primary">Purchase Items</h5>
          </div>
          <div class="col-4"></div>
        </div>

        <div class="row mt-3 bg-muted">
          <div class="col-12 shadow rounded items">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th></th>
                  <th>Item</th>
                  <th>Item Name</th>
                  <th>Customer Order</th>
                  <th>Quantity</th>
                  <th>Arrived</th>
                  <th>Measurement</th>
                  <th>Price</th>
                  <th *ngIf="!editItem">shipping</th>
                  <th *ngIf="editItem">Coin</th>
                  <th>Arrival Date</th>
                  <th>Remarks</th>
                </tr>
              </thead>


              <tbody>
                <tr *ngFor="let stockitem of newPurchase.controls.stockitems.value; let i = index">

                  <td *ngIf="!editItem"><input class="text-primary" #cb type="checkbox"
                      (change)="selectItem(i, cb.checked)"></td>
                  <td *ngIf="editItem && itemIndex == i"><input class="text-primary" #cb type="checkbox"
                      (change)="selectItem(i, cb.checked)"></td>

                  <td *ngIf="!editItem">{{stockitem.number}}</td>
                  <td *ngIf="editItem && itemIndex == i">{{stockitem.number}}</td>

                  <td *ngIf="!editItem">{{stockitem.name}}</td>
                  <td *ngIf="editItem && itemIndex == i">{{stockitem.name}}</td>
                  
                  <td *ngIf="!editItem && stockitem.isStock">Stock</td>
                  <td *ngIf="!editItem && !stockitem.isStock">
                    Orders: <span *ngFor="let order of stockitem.customerOrders">{{order}},&nbsp;</span>
                  </td>
                  <td *ngIf="editItem && itemIndex == i && stockitem.isStock">Stock</td>
                  <td *ngIf="editItem && itemIndex == i && !stockitem.isStock">
                    <ng-container *ngFor="let order of stockitem.customerOrders; let j = index">
                      <input  type="text" (change)="changeOrder(i, order, j)" [ngModelOptions]="{standalone: true}" [(ngModel)]="order"
                      [style.width]="'77px'">
                      <button placement="bottom" ngbTooltip="Delete this order" (click)="deleteCusomerOrderNumber(i,j)">X</button>
                    </ng-container>
                    <br>
                    <button placement="bottom" ngbTooltip="Add customer order" (click)="wow = true">+</button>
                    <input *ngIf="wow" type="text" (change)="addOrderToPurchase(i, $event)">
                  </td>

                  <td *ngIf="!editItem">{{stockitem.quantity}}</td>
                  <td *ngIf="editItem && itemIndex == i">
                    <input type="text" [ngModelOptions]="{standalone: true}" [(ngModel)]="stockitem.quantity"
                      [style.width]="'77px'">
                  </td>

                  <td *ngIf="!editItem"><span *ngIf="stockitem.arrivedAmount">{{stockitem.arrivedAmount}}</span></td>
                  <td *ngIf="editItem && itemIndex == i"><span
                      *ngIf="stockitem.arrivedAmount">{{stockitem.arrivedAmount}}</span></td>

                  <td *ngIf="!editItem">{{stockitem.measurement}}</td>
                  <td *ngIf="editItem && itemIndex == i">
                    <select [ngModelOptions]="{standalone: true}" [(ngModel)]="stockitem.measurement"
                      [style.width]="'70px'">
                      <option value="">Measurement</option>
                      <option value="kilogram">kilogram</option>
                      <option value="liter">liter</option>
                      <option value="meter">meter</option>
                      <option value="ml">ml</option>
                      <option value="unit">Unit</option>
                      <option value="ton">טון</option>
                      <option value="box">קופסא</option>
                    </select>
                  </td>

                  <td *ngIf="!editItem">{{stockitem.price}} {{stockitem.coin}}</td>
                  <td *ngIf="editItem && itemIndex == i">
                    <input type="number" [ngModelOptions]="{standalone: true}" [(ngModel)]="stockitem.price"
                      [style.width]="'77px'">
                  </td>

                  <td *ngIf="!editItem">{{stockitem.shippingPrice | currency: stockitem.coin}}</td>
                  <td *ngIf="editItem && itemIndex == i">
                    <select [(ngModel)]="stockitem.coin" [ngModelOptions]="{standalone: true}" [style.width]="'77px'"
                      required>
                      <option value="" disabled>Coin</option>
                      <option value="NIS">NIS</option>
                      <option value="usd">USD</option>
                      <option value="eur">EUR</option>
                      <option value="gbp">GBP</option>
                    </select>
                  </td>

                  <td *ngIf="!editItem">{{stockitem.itemArrival | date: 'dd/MM/yy'}}</td>
                  <td *ngIf="editItem && itemIndex == i">
                    <input type="date" [ngModelOptions]="{standalone: true}" [(ngModel)]="stockitem.itemArrival"
                      [style.width]="'120px'">
                  </td>

                  <td *ngIf="!editItem">{{stockitem.remarks}}</td>
                  <td *ngIf="editItem && itemIndex == i">
                    <textarea [(ngModel)]="stockitem.remarks" [ngModelOptions]="{standalone: true}" type="number"
                      [style.width]="'100px'" placeholder="Item Remarks"></textarea>
                  </td>

                  <td *ngIf="!disabled && !editItem"><i (click)="openToEdit(i)" placement="top" ngbTooltip="Edit Item"
                      class="click fa fa-pencil-alt text-primary"></i></td>
                  <td><i *ngIf="!disabled  && editItem && itemIndex == i" placement="top" ngbTooltip="Edit Item" (click)="openToEdit(i)"
                      class="click fa fa-pencil-alt text-primary"></i></td>

                  <!-- <td *ngIf="!disabled && !editItem"><i (click)="editItem = !editItem"
                      class="click fa fa-times text-primary"></i></td> -->
                  <td><i *ngIf="!disabled && editItem && itemIndex == i" placement="top" ngbTooltip="Exit Edit" (click)="editItem = !editItem"
                      class="click fa fa-times text-primary"></i></td>

                  <!-- <td *ngIf="!disabled && !editItem"><i (click)="updateItems(stockitem)"
                      class="click fa fa-save text-primary h4"></i></td> -->
                  <td><i *ngIf="!disabled && editItem && itemIndex == i" (click)="updateItems(stockitem)"
                      class="click fa fa-save text-primary h4"></i></td>

                  <td *ngIf="!disabled && !editItem"><i placement="top" ngbTooltip="Remove Item From Purchase" (click)="removeStockitemFromPurchase(i)"
                      class="click fa fa-times text-danger"></i></td>
                  <td><i *ngIf="!disabled && editItem && itemIndex == i" placement="top" ngbTooltip="Remove Item From Purchase" (click)="removeStockitemFromPurchase(i)"
                      class="click fa fa-times text-danger"></i></td>

                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <hr class="text-muted">

        <div class="row mt-2">
          <div class="col">
            <button (click)="showItemDetails = !showItemDetails" [disabled]="disabled"
              class="btn btn-primary dropdown-toggle">
              {{showItemDetails ? 'Hide Details' : 'Add Item'}}
            </button>
          </div>
        </div>
        <form [formGroup]="itemForm" (ngSubmit)="addItemToPurchase()">
          <div *ngIf="showItemDetails">

            <div class="row mt-3">
              <div class="col">
                <h5 class="text-secondary">Item Details</h5>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col-6 d-flex flex-row">
                <div class="col-6">
                  <label>Item Number</label>
                  <span class="red float-left h4">*</span>
                  <input (blur)="findStockItemByNumber()" formControlName="number" type="text" class="form-control"
                    placeholder="Item Number" required>
                </div>
                <div class="col-6">
                  <label>Item Name</label>
                  <input formControlName="name" type="text" class="form-control" placeholder="Item Name" required>
                </div>
              </div>
              <div class="col-6 d-flex flex-row">
                <div class="col-6">
                  <label>Quantity</label>
                  <input placement="bottom" [ngbTooltip]="lastorders" formControlName="quantity" type="number"
                    class="form-control" placeholder="Quantity" required>
                </div>
                <div class="col-6">
                  <label>Measurement</label>
                  <select formControlName="measurement" class="form-control" required>
                    <option value="">Measurement</option>
                    <option value="kilogram">kilogram</option>
                    <option value="liter">liter</option>
                    <option value="meter">meter</option>
                    <option value="ml">ml</option>
                    <option value="unit">Unit</option>
                    <option value="ton">טון</option>
                    <option value="unit">יחידה</option>
                    <option value="box">קופסא</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col-6 d-flex flex-row">
                <div class="col-6">
                  <label>Price</label>
                  <input formControlName="price" type="number" class="form-control" placeholder="Price">
                </div>
                <div class="col-6">
                  <label>Coin</label>
                  <select formControlName="coin" class="form-control" required>
                    <option value="" disabled>Coin</option>
                    <option value="NIS">NIS</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                  </select>
                </div>
              </div>
              <div class="col-6 d-flex flex-row">
                <div class="col-6 ml-10">
                  <label>Item Arrival Date</label>
                  <input formControlName="itemArrival" class="form-control" type="date" placeholder="Item Arrival">
                </div>
                <div class="col-6 ml-10">
                  <label>Destination</label>
                  <div class="d-flex flex-row">
                    <input type="radio" formControlName="isStock" [value]="true">
                    <label>Stock</label><br>
                    <input type="radio" formControlName="isStock" [value]="false">
                    <label>Customer Order</label><br>
                  </div>
                  <div *ngIf="!itemForm.get('isStock').value">
                      <input placeholder="Order Number" maxlength="4" type="number" #customerOrderNumber>
                      <button type="button" (click)="addCusomerOrderNumberToItem(customerOrderNumber)"><i class="fas fa-plus"></i></button>
                      Orders: <span *ngFor="let order of itemForm.get('customerOrders').value">{{order}},&nbsp;</span>
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="showItemDetails" class="row mt-4">
              <textarea formControlName="remarks" type="number" class="form-control"
                placeholder="Item Remarks"></textarea>
            </div>

            <div class="row mt-1">
              <div class="col-5"></div>
              <div class="col-2" [ngbTooltip]="itemFormErrors" placement="bottom">
                <button type="submit" [disabled]="itemForm.invalid"
                  [style.cursor]="itemForm.invalid ? 'not-allowed' : 'pointer' " class="btn btn-primary form-control">
                  <i class="fa fa-plus"></i>
                </button>
              </div>
              <div class="col-5"></div>
            </div>
          </div>
        </form>

        <hr class="text-muted">

        <div class="row mt-1">
          <div class="col-sm-12 col-md-12 form-group">
            <label for="remarks">Remarks</label>
            <textarea formControlName="remarks" [disabled]="disabled" value="purchaseData.remarks" class="form-control"
              placeholder="Purchase Remarks"></textarea>
          </div>
        </div>
        <hr class="text-muted">

        <div class="row mt-3">
          <div class="col-4"></div>
          <div class="col-4">
            <button (click)="sendNewProc('update')" [disabled]="disabled || sendingPurchase"
              [style.cursor]="sendingPurchase ? 'not-allowed' : 'pointer'" class="btn btn-primary form-control"
              [ngClass]="showPurchaseDetails && showItemDetails ? 'fixed' : ''">Confirm</button>
          </div>
          <div class="col-4"></div>
        </div>
      </form>
    </div>
  </div>
</div>

<!----------------------------------------------------------------------------------------------------------------------->
<!--ADD-->
<div *ngIf="!purchaseData" style="border-radius: 15px;"
  class="container1 bg-white border shadow-lg text-center p-2 m-2">
  <div class="row">
    <div class="col-12 p-3">
      <form [formGroup]="newPurchase">

        <div class="row mt-1">
          <div class="col-4"></div>
          <div class="col-4">
            <div class="bg-primary rounded">
              <h3 class="text-white p-2">New Purchase Order</h3>
            </div>
          </div>
          <div class="col-4">
            <i (click)="closeOrderModal.emit(false)" class="h1 close click fa fa-times text-primary float-right"></i>
          </div>
        </div>


        <div class="row mt-5">
          <div class="col">
            <h5 class="text-secondary">Purchase Details</h5>
          </div>
        </div>
        <div class="row">
          <div class="col form-group">
            <span class="red float-left h4">*</span>
            <label>Component Type</label>
            <select formControlName="orderType" type="text" class="form-control" placeholder="Order Type">
              <option value="component">Component</option>
              <option value="material">Material</option>
            </select>
          </div>
          <!-- <div class="col form-group">
            <span class="red float-left h4">*</span>
            <label>Status</label>
            <select formControlName="status" class="form-control">
              <option value="open" selected="true">open</option>
              <option value="waitingForApproval">ממתין לאישור</option>
            </select>
          </div> -->
          <div class="col form-group">
            <label>Arrival Date</label>
            <input formControlName="itemArrival" class="form-control" type="date">
          </div>
        </div>

        <div class="row">
          <div class="col-12 form-group">
            <textarea placeholder="Purchase Remarks" formControlName="remarks" class="form-control"></textarea>
          </div>
        </div>

        <hr class="text-muted">
        <div class="row mt-3">
          <div class="col">
            <h5 class="text-secondary">Supplier Details</h5>
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-sm-12 col-md-3 form-group">
            <span class="red float-left h4">*</span>
            <input formControlName="supplierName" name="supplierName" (change)="fillSupplierDetails($event)"
              list="suppliers" type="text" class="form-control" placeholder="Supplier Name" required>
            <datalist id="suppliers">
              <option *ngFor="let supplier of allSuppliers" [value]="supplier.suplierName">{{supplier.suplierNumber}}
              </option>
            </datalist>
          </div>
          <div class="col-sm-12 col-md-3 form-group">
            <span class="red float-left h4">*</span>
            <input formControlName="supplierNumber" type="text" class="form-control" placeholder="Supplier Number"
              required>
          </div>
          <div class="col-sm-12 col-md-3 form-group">
            <span class="red float-left h4"> &nbsp;</span>
            <input (change)="updateSupplierEmail($event)" formControlName="supplierEmail" type="text"
              class="form-control" placeholder="Supplier Email">
          </div>
          <div class="col-sm-12 col-md-3 form-group">
            <span class="red float-left h4"> &nbsp;</span>
            <input disabled formControlName="supplierCountry" type="text"
              class="form-control" placeholder="Supplier Country">
          </div>

        </div>

        <hr class="text-muted">
        <div class="row mt-2">
          <div class="col">
            <button (click)="showItemDetails = !showItemDetails" class="btn btn-primary dropdown-toggle">
              {{showItemDetails ? 'Hide Details' : 'Add Item'}}
            </button>
          </div>
        </div>

        <form [formGroup]="itemForm" (ngSubmit)="addItemToPurchase()">

          <div *ngIf="showItemDetails">

            <div class="row mt-3">
              <div class="col">
                <h5 class="text-secondary">Item Details</h5>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col-6 d-flex flex-row">
                <div class="col-6">
                  <label>Item Number</label>
                  <span class="red float-left h4">*</span>
                  <input (blur)="findStockItemByNumber()" formControlName="number" type="text" class="form-control"
                    placeholder="Item Number" required>
                </div>
                <div class="col-6">
                  <label>Item Name</label>
                  <input formControlName="name" type="text" class="form-control" placeholder="Item Name" required>
                </div>
              </div>
              <div class="col-6 d-flex flex-row">
                <div class="col-6">
                  <label>Quantity</label>
                  <input placement="bottom" [ngbTooltip]="lastorders" formControlName="quantity" type="number"
                    class="form-control" placeholder="Quantity" required>
                </div>
                <div class="col-6">
                  <label>Measurement</label>
                  <select formControlName="measurement" class="form-control" required>
                    <option value="">Measurement</option>
                    <option value="kilogram">kilogram</option>
                    <option value="liter">liter</option>
                    <option value="meter">meter</option>
                    <option value="ml">ml</option>
                    <option value="unit">Unit</option>
                    <option value="ton">טון</option>
                    <option value="unit">יחידה</option>
                    <option value="box">קופסא</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col-6 d-flex flex-row">
                <div class="col-6">
                  <label>Price</label>
                  <input formControlName="price" type="number" class="form-control" placeholder="Price">
                </div>
                <div class="col-6">
                  <label>Coin</label>
                  <select formControlName="coin" class="form-control" required>
                    <option value="" disabled>Coin</option>
                    <option value="NIS">NIS</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                  </select>
                </div>
              </div>
              <div class="col-6 d-flex flex-row">
                <div class="col-6 ml-10">
                  <label>Item Arrival Date</label>
                  <input formControlName="itemArrival" type="date" class="form-control" placeholder="Item Arrival">
                </div>
                <div class="col-6 ml-10">
                  <label>Destination</label>
                  <div class="d-flex flex-row">
                    <input type="radio" formControlName="isStock" [value]="true">
                    <label>Stock</label><br>
                    <input type="radio" formControlName="isStock" [value]="false">
                    <label>Customer Order</label><br>
                  </div>
                  <div *ngIf="!itemForm.get('isStock').value">
                    <input placeholder="Order Number" maxlength="4" type="number" #customerOrderNumber>
                    <button type="button" (click)="addCusomerOrderNumberToItem(customerOrderNumber)"><i class="fas fa-plus"></i></button>
                    Orders: <span *ngFor="let order of itemForm.get('customerOrders').value">{{order}},&nbsp;</span>
                </div>
                </div>
              </div>
            </div>

            <div *ngIf="showItemDetails" class="row mt-4">
              <textarea formControlName="remarks" type="number" class="form-control"
                placeholder="Item Remarks"></textarea>
            </div>

            <div *ngIf="showItemDetails" class="row mt-1">
              <div class="col-5"></div>
              <div [ngbTooltip]="itemFormErrors" placement="bottom" class="col-2">
                <button type="button" (click)="addItemToPurchase()" [disabled]="itemForm.invalid"
                  [style.cursor]="itemForm.invalid ? 'not-allowed' : 'pointer' " class="btn btn-primary form-control">
                  <i class="fa fa-plus"></i>
                </button>
              </div>
              <div class="col-5"></div>
            </div>
          </div>
        </form>


        <div class="row mt-4">
          <div class="col-4"></div>
          <div class="col-4">
            <h6 class="text-primary">Purchase Items</h6>
          </div>
          <div class="col-4"></div>
        </div>

        <div class="row mt-3 bg-muted">
          <div style="height: 300px;overflow-y: scroll;" class="col-12 shadow rounded items">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Item Name</th>
                  <th>Destination</th>
                  <th>Measurement</th>
                  <th>Quantity</th>
                  <th>Price</th>
                  <th>Arrival Date</th>
                  <th>-</th>
                  <th>-</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let stockitem of this.newPurchase.controls.stockitems.value;let i = index">
                 
                  <td>{{stockitem.number}}</td>
                 
                  <td>{{stockitem.name}}</td>

                  <th *ngIf="stockitem.isStock">Stock</th>
                  <th *ngIf="!stockitem.isStock">
                    Orders: <span *ngFor="let order of stockitem.customerOrders">{{order}},&nbsp;</span>
                  </th>
                 
                  <td>{{stockitem.measurement}}</td>
                  <td *ngIf="EditRowId == ''">{{stockitem.quantity}}</td>
                  <td *ngIf="EditRowId == stockitem.number">
                    <input #editQuantity [value]="stockitem.quantity" type="number">
                  </td>

                  <td *ngIf="EditRowId == ''">{{stockitem.price}} {{stockitem.coin}}</td>
                  <td *ngIf="EditRowId == stockitem.number">
                    <input #editPrice [value]="stockitem.price" type="number">
                  </td>
                  <td *ngIf="EditRowId == ''">{{stockitem.itemArrival}}</td>
                  <td *ngIf="EditRowId == stockitem.number">
                    <input #editArrival type="date" [value]="stockitem.itemArrival">
                  </td>

                  <i *ngIf="EditRowId == ''" (click)="editStockItem(stockitem.number)"
                    class="click fa fa-pencil-alt text-primary"></i>
                  <i *ngIf="EditRowId == stockitem.number" (click)="saveStockItem(i)"
                    class="click fa fa-save text-primary"></i>
                  <td><i (click)="removeStockitemFromPurchase(i)" class="click fa fa-times text-danger"></i></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>


        <hr class="text-muted">

        <div class="row mt-3">
          <div class="col-4"></div>
          <div class="col-4">
            <button (click)="sendNewProc('add')" [disabled]="EditRowId != '' || !newPurchase.valid || sendingPurchase"
              *ngIf="newPurchaseAllowed"
              [style.cursor]="sendingPurchase || !newPurchase.valid ? 'not-allowed' : 'pointer'"
              class="btn btn-primary form-control" [ngClass]="showItemDetails ? 'fixed' : ''">Confirm</button>
          </div>
          <div class="col-4"></div>
        </div>
      </form>
    </div>
  </div>
</div>

<ng-template class="p-6" #recieveDeliveryCertificate let-modal>
  <div class="modal-header bg-primary">
    <h4 class="modal-title text-center" id="modal-basic-title">קבלת משלוח</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div dir="rtl" class="modal-body p-5">
    <h1>דווח על קבלת תעודת משלוח</h1>

    <div class="container bg-white border border-primary shadow-lg text-center p-5">

      <!-- <form [formGroup]="deliveryCertificateForm" (ngSubmit)="saveCertificate()"> -->
      <div class="row mt-2"><span class="red">*</span> שדה חובה </div>
      <div class="row mt-2">
        <div class="col-md-4 form-group">
          <label for="certificateNumber">מספר תעודה<span class="red">*</span></label>
          <input [(ngModel)]="deliveryCertificate.certificateNumber" (keyup)="checkCertValidation()" maxlength="4"
            type="text" class="form-control" placeholder="4 ספרות אחרונות" required>
        </div>
        <div class="col-md-4 form-group">
          <label for="deliveryArrivalDate">תאריך קבלת משלוח<span class="red">*</span></label>
          <input [(ngModel)]="deliveryCertificate.deliveryArrivalDate" (change)="checkCertValidation()" type="date"
            class="form-control" required>
        </div>

        <div class="row mt-3 bg-muted m-3">
          <div class="shadow rounded items">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>מק"ט</th>
                  <th>שם הפריט</th>
                  <th>כמות</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let stockitem of selectedItems; let i = index">
                  <td>{{stockitem.number}}</td>
                  <td>{{stockitem.name}}</td>
                  <td><input class="smaller-input" type="number" #certItemAmount (keyup)="checkCertValidation()"
                      (keyup)="checkItemAmount(i, stockitem.number, $event, certItemAmount)"
                      (blur)="checkCertValidation()"
                      (click)="checkItemAmount(i, stockitem.number, $event, certItemAmount)"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="col-md-4 form-group">
          <label for="remarks">הערות</label>
          <input [(ngModel)]="deliveryCertificate.remarks" type="text" class="form-control" placeholder="הערות">
        </div>
        <br>
        <button *ngIf="!submittingCert" (click)="saveCertificate()"
          [style.cursor]="certValid ? 'pointer' : 'not-allowed'" [disabled]="!certValid"
          class="btn btn-primary form-control">
          הוסף את התעודה להזמנה מס' {{purchaseData.orderNumber}}
        </button>
        <div class="smallLoader" *ngIf="submittingCert"></div>
      </div>
    </div>
  </div>
</ng-template>



<ng-template #receiveInvoice let-modal>
  <div class="modal-header bg-primary">
    <h4 style="margin-left:auto" class="modal-title text-white" id="modal-basic-title">קבלת חשבונית</h4>
    <button type="button" class="close text-white" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div dir="rtl" class="modal-body">
    <div class="row">
      <div class="col-12">
        <h4>קבלת חשבונית</h4>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-2">
        <span class="red">*</span> שדה חובה
      </div>
      <div class="col-10"></div>
    </div>

    <!-- invoice number and remarks-->
    <div class="row mt-2">
      <div class="col-md-4 form-group">
        <label for="invoiceNumber">מספר חשבונית<span class="red">*</span></label>
        <input type="number" class="form-control" [(ngModel)]="invoice.purchaseInvoiceNumber" placeholder="מספר חשבונית"
          required>
      </div>
      <div class="col-md-4 form-group">
        <label for="remarks">הערות</label>
        <input type="text" class="form-control" [(ngModel)]="invoice.invoiceRemarks" placeholder="הערות">
      </div>
    </div>



    <div class="row mt-2">
      <button [disabled]="!invoice.purchaseInvoiceNumber || invoice.purchaseInvoiceNumber == 0"
        (click)="saveInvoiceToPurchase()" class="btn btn-primary form-control">
        הוסף חשבונית להזמנה מס' {{purchaseData.orderNumber}}
      </button>
    </div>
  </div>
</ng-template>


<ng-template class="p-6" #certAndInvModal let-modal>
  <div class="modal-header bg-primary">
    <h4 class="modal-title text-center" id="modal-basic-title">קבלת משלוח</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div dir="rtl" class="modal-body p-5">

    <h3> חשבוניות ותעודות משלוח להזמנה {{purchaseData.orderNumber}}</h3>

    <div class="container bg-white border border-primary shadow-lg text-center p-5">


      <h5>חשבוניות</h5>
      <div *ngIf="purchaseData.billNumber" class="row mt-3 bg-muted">
        <div style="background: #d5cff9" class="col-12 shadow rounded">
          <table style=" overflow: auto;" class="table table-hover">
            <thead>
              <tr>
                <th>מספר חשבונית</th>
                <th>מחיר העמסה </th>
                <th> מחיר העמסה לפריט </th>
                <th>הערות</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let invoice of purchaseData.billNumber">
                <td>{{invoice.purchaseInvoiceNumber}}</td>
                <td>{{invoice.fixedPrice}}</td>
                <td>{{invoice.shippingPrice | currency: invoice.invoiceCoin}}</td>
                <td>{{invoice.remarks}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <h5>תעודות משלוח</h5>
      <div class="row mt-3 bg-muted">
        <div *ngIf="purchaseData.deliveryCerts" style="background: #d5cff9" class="col-12 shadow rounded">
          <table style="overflow: auto;" class="table table-striped">
            <thead>
              <tr>
                <th></th>
                <th>מספר תעודה</th>
                <th>תאריך הגעה</th>
                <th>פריטים</th>
                <th>מקבל התעודה</th>
                <th>הערות</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let deliveryCert of purchaseData.deliveryCerts; let i = index">
                <td class="click hover-red text-danger" (click)="deleteCert(i, deliveryCert.certificateNumber)">
                  <i class="fa fa-times text-danger"></i>
                  <strong>מחק תעודה</strong>
                </td>
                <td>{{deliveryCert.certificateNumber}}</td>
                <td>{{deliveryCert.deliveryArrivalDate | date:'d/M/YY'}}</td>
                <td>
                  <table style="overflow: auto;" class="table">
                    <!-- <thead>
                      <tr>
                        <th>מספר פריט</th>
                        <th>שם פריט</th>
                        <th>כמות</th>
                      </tr>
                    </thead> -->
                    <tbody>
                      <tr *ngFor="let item of deliveryCert.stockitems">
                        <td>{{item.number}}</td>
                        <td>{{item.name}}</td>
                        <td>{{item.quantity}}</td>
                      </tr>
                    </tbody>
                  </table>
                </td>
                <td>{{deliveryCert.userName}}</td>
                <td>{{deliveryCert.remarks}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</ng-template>



<ng-template class="p-6" #sumShipping let-modal>
  <div class="modal-header bg-primary">
    <h4 class="modal-title text-center" id="modal-basic-title">נתוני סגירה</h4>

    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div dir="rtl" class="modal-body p-5">
    <div class="d-flex flex-row justify-content-around">
      <li class="list-group-item">
        &#x24; = {{currencies.USD}} &#8362;
      </li>
      <li class="list-group-item">
        &#xa3; = {{currencies.GBP}} &#8362;
      </li>
      <li class="list-group-item">
        &#x20AC; = {{currencies.EUR}} &#8362;
      </li>
    </div>
    <div class="row mt-2">
      <div class="col-md-4 form-group">
        <label>מחיר הזמנה סופי</label>
        <input type="number" class="form-control" placeholder="מחיר הזמנה סופי" #orderPrice>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-md-4 form-group">
        <label>מחיר העמסה</label>
        <input type="number" class="form-control" placeholder="מחיר העמסה סופי" #shippingPrice>
      </div>
      <div class="col-md-4 form-group">
        <label>מע"מ 1</label>
        <input type="number" class="form-control" placeholder='מע"מ 1' #tax1>
      </div>
      <div class="col-md-4 form-group">
        <label>מע"מ 2</label>
        <input type="number" class="form-control" placeholder='מע"מ 2' #tax2>
      </div>
      <div class="col-md-4 form-group">
        <button class="btn btn-secondary"
          (click)="calculateShipping(orderPrice.value, shippingPrice.value, tax1.value, tax2.value, true); modal.dismiss('Cross click'); ">
          עדכן נתוני העמסה
        </button>
      </div>
    </div>
  </div>

</ng-template>

<ng-template class="tooltip" #lastorders>
  <h3 class="head">Amounts by year:</h3>
  <div class="d-flex flex-column">
    <div *ngFor="let orderItem of itemForm.controls.historyAmounts.value">
      <span class="year">{{orderItem.year}}:</span> &nbsp;&nbsp; <span class="amount">{{ orderItem.amount}}
        {{itemForm.controls.measurement.value}} </span>
    </div>
  </div>
  <h3 class="head">Last supplier:</h3>
  <div class="">
    <span class="year">{{lastSupplier}} </span>
  </div>
</ng-template>

<ng-template #itemFormErrors>
  <div *ngIf="itemForm.invalid" class="bg-danger">
    <div class="d-flex flex-column">
      <div *ngFor="let control of itemForm.controls | keyvalue">
        <h4 *ngIf="control.value.status == 'INVALID'">Please fill {{control.key}}</h4>
      </div>
    </div>
  </div>
</ng-template>