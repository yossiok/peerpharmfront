<div class="text-center shadow bg-white w-75 mx-auto rounded p-5">
  <div class="row mt-4">
    <div class="col-12">
      <h1 style="text-shadow: 2px 2px 4px #000000;" class="text-info ">רשימת מדפים</h1>
    </div>
  </div>

  <div dir="rtl" class="row mt-4">
    <div *ngIf="whareHouse" class="col-1">
      <button [printStyle]="{tr : {'border': 'solid 1px black'}}" style="visibility: hidden;"
        printSectionId="print-section" #printStocktake ngxPrint><img src="../../../../assets/images/print.png"
          alt="Print" style="width: 55px;"></button>
      <img style="width: 50px; height: 50px" (click)="exportShelfListToXl()" src="../../../../assets/images/excel.png"
        alt="">
    </div>

    <div class="col-3">

      <label>מחסן</label>
      <select (change)="getShelfsByWH($event)" class="form-control">
        <option selected="true" disabled="disabled">בחר מחסן</option>
        <option value="Kasem">Kasem</option>
        <option value="material">Rosh HaAyin - Materials</option>
        <option value="component">Rosh HaAyin - Components</option>
        <option value="Rosh HaAyin products">Rosh HaAyin - Products</option>
        <option value="NEW KASEM">New Kasem</option>
        <option value="Labels">Labels</option>
      </select>
    </div>
    <div *ngIf="whareHouse" class="col-3">
      <label>סנן לפי איתור</label>
      <input class="form-control" (keyup)="filterByShelf($event)">
    </div>
    <div *ngIf="whareHouse" class="col-3">
      <label>סנן לפי פריט</label>
      <input list="itemNumbers" class="form-control" type="text" (change)="filterByIetmNumber($event)">
      <datalist id="itemNumbers">
        <option *ngFor="let shelf of allShelfsCopy" [value]="shelf._id.item">{{shelf._id.item}}</option>
      </datalist>
    </div>
  </div>

  <div dir="rtl" *ngIf="allowedCountYear && allShelfs && allShelfs.length > 0"
    class="new-shelf d-flex flex-row justify-content-around p-5 mt-5 mb-5">
    <form [formGroup]="newShelfForm" (ngSubmit)="addNewItemShelf()">
      <h3>הכנס מלאי שלא נמצא ברשימה (יש לוודא שהמדף אכן קיים במחסן)</h3>
      <div class="row">
        <div class="col-3">
          <input type="number" class="form-control" (change)="validateItem()" formControlName="item" placeholder='מק"ט'>
        </div>
        <div class="col-3">
          <select class="form-control" formControlName="position">
            <option value="">איתור</option>
            <option *ngFor="let shelf of shellNums" [value]="shelf._id">{{shelf.position}}</option>
          </select>
        </div>
        <div class="col-3">
          <input type="number" class="form-control" formControlName="amount" placeholder="כמות">
        </div>
        <div class="col-3"><button [disabled]="!newShelfForm.valid"
            [style.cursor]="whareHouse ? 'pointer' : 'not-allowed'" type="submit" class="btn btn-primary">הכנס</button>
        </div>
      </div>
    </form>

  </div>

  <div dir="rtl" *ngIf="whareHouse" id="print-section" class="row mt-4">
    <table dir="rtl" class="table table-bordered table-hover">
      <thead>
        <tr>
          <td class="header" colspan="3">
            דף ספירת מלאי לשנת הכספים 2021
          </td>
          <td class="header" colspan="5">
            Peerpharm Ltd - עמל 17 אזור תעשיה ,אפק ראש העין 4809256.
          </td>
        </tr>
        <tr>
          <td class="header" colspan="3">
            מלאי {{whareHouse}} - {{itemType}}s
          </td>
          <td class="header" colspan="5">
            טופס מספר {{lastYearCount.serialNumber + 1}}
          </td>
        </tr>
        <tr>
          <th class="runner">#</th>
          <th class="sortable item" (click)="sortByItem()"><i class="fas fa-filter"></i> מק"ט</th>
          <th class="sortable desc" (click)="sortByItem()"><i class="fas fa-filter"></i> תיאור</th>
          <th class="batch" *ngIf="itemType == 'material'" (click)="sortByBatch()"><i class="fas fa-filter"></i> באטץ'</th>
          <th class="sortable position" (click)="sortByPosition()"><i class="fas fa-filter"></i> איתור</th>
          <th class="measure"> יחידת מידה</th>
          <!-- <th class="sortable" (click)="sortByAmount()"><i class="fas fa-filter"></i> כמות</th> -->
          <!-- <th>Last Count Date</th> -->
          <!-- <th>Last Counted Amount</th> -->
          <th class="count">ספירה נוכחית</th>
          <th class="owner">פריט חברה?</th>
          <th class="remarks">הערות</th>
          <!-- <th>פער</th> -->
          <!-- <th *ngIf="allowedCountYear && !printing"></th> -->
        </tr>
      </thead>
      <ng-container *ngIf="fetchingShelfs">
        <div class="bigLoader"></div>
      </ng-container>
   
      <tbody *ngIf="!fetchingShelfs">

        <tr *ngFor="let shelf of allShelfs;let i = index">
          <td>{{i+1}}</td>
          <td>{{shelf._id.item}}</td>
          <td>{{shelf._id.name}}</td>
          <td *ngIf="itemType == 'material'">{{shelf._id.supplierBatchNumber}}</td>
          <!-- <td>{{shelf._id.position}}</td> -->
          <td></td>
          <td></td>
          <!-- <td>{{shelf.total}}</td> -->
          <!-- <td>{{shelf.lastCount.date}}</td> -->
          <!-- <td>{{shelf.lastCount.amount}}</td> -->

          <td *ngIf="shelfId != shelf._id">{{shelf.countedAmount}}</td>
          <td *ngIf="shelfId != shelf._id"> כן / לא </td>
          <td *ngIf="shelfId != shelf._id"></td>
          <td *ngIf="shelfId == shelf._id">
            <input #countInput type="number" class="form-control" (keyup)="calculateDifference(shelf)"
              [(ngModel)]="shelf.countedAmount">
          </td>

          <!-- <td><span *ngIf="shelf.difference">{{shelf.difference}}</span></td> -->

          <!-- <td *ngIf="allowedCountYear && shelfId != shelf._id && !printing">
            <button (click)="editShelfAmount(shelf)" class="btn btn-primary">
              <i class="click fa fa-pencil-alt"></i> הכנס ספירה
            </button>
          </td> -->

          <!-- <td *ngIf="allowedCountYear && shelfId == shelf._id && !printing">
            <button [disabled]="updatingAmount" [style.cursor]="updatingAmount ? 'progress' : 'pointer'"
              (click)="setShelfs()" class="btn btn-danger">שמור לטופס
            </button>
          </td> -->

        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3">שם הסופר/ת: __________________</td>
          <td colspan="2">תאריך ספירה: ____________________</td>
          <td colspan="2">חתימת הסופר/ת: _______________</td>
        </tr>
        <tr>
          <td colspan="3">שם הבקר/ית: __________________</td>
          <td colspan="2">תאריך הבדיקה: ____________________</td>
          <td colspan="2">חתימת הבקר/ית: _______________</td>
        </tr>
        <tr>
          <td colspan="2">שם המקליד/ה: __________________</td>
          <td colspan="2">תאריך הקלדה: ____________________</td>
          <td>שעה: _______________</td>
          <td colspan="2">חתימת המקליד/ה: _______________</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div *ngIf="allowedCountYear" class="row mt-4">
    <div class="col-3"></div>
    <div class="col-6">
      <button *ngIf="whareHouse" ngxPrint printSectionId="print-section"
        styleSheetFile="../../../../assets/stylesheets/year-count.css" class="btn save-form w-50">הדפס דף סופר</button>
    </div>
    <div class="col-3"></div>
  </div>

  <!-- <div *ngIf="allowedCountYear" class="row mt-4">
    <div class="col-3"></div>
    <div class="col-6">
      <button *ngIf="whareHouse" ngxPrint printSectionId="print-section" (click)="takeStock()" class="btn save-form w-50">עדכן מלאי {{whareHouse}} - {{itemType}}s</button>
    </div>
    <div class="col-3"></div>
  </div> -->


</div>


<ng-template #updatesModal let-modal>

  <div dir="rtl" class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">אתה עומד לעדכן את הפריטים הבאים:</h4>
    </div>
    <div class="modal-body">
      <table class='table'>
        <thead class='tableHeader'>

          <tr>
            <th>פריט</th>
            <th>מיקום</th>
            <th *ngIf="itemType == 'material'">באטץ'</th>
            <th>כמות ישנה</th>
            <th>כמות חדשה</th>
          </tr>
        </thead>
        <tbody id="table_body">
          <tr *ngFor="let update of updates">
            <td>{{update._id.item}}</td>
            <td>{{update._id.position}}</td>
            <td *ngIf="itemType == 'material'">{{update._id.supplierBatchNumber}}</td>
            <td>{{update.total}}</td>
            <td [style.background]="'lightcoral'">{{update.countedAmount}}</td>
          </tr>
        </tbody>
      </table>
      <br>
      <div class="row mt-4">
        <h4>האם ברצונך להמשיך?</h4>
        <div class="m-4 d-flex flex-row justify-content-around w-75">
          <button class="btn btn-danger" (click)="update()">כן</button>
          <button class="btn btn-secondary" (click)="modalService.dismissAll()">ביטול</button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
    </div>
  </div>

</ng-template>