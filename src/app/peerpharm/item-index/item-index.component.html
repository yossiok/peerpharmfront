

<!-- Item Details Form-->

<div class="row mt-4 text-center">
  <h3 [ngClass]="setColors('title1')" (click)="showDetailsForm = !showDetailsForm" class="text-center mx-auto p-2">Item Details</h3>
</div>

<form *ngIf="showDetailsForm" [formGroup]="itemDetailsForm" (ngSubmit)="getItemData()">
  <div class="row border border-success rounded p-4 w-50 form-group mx-auto">
    <div class="col-2">
      <label>
        Enter number,
      </label>
      <input type="text" #itemNumber formControlName="itemNumber" class="form-control">
    </div>
    <div class="col-2">
    <label class="d-block">
      or find by name.
    </label>
    <input class="d-inline form-control" type="text" #name>
    <button class="d-inline" type="button" (click)="getNames(name)">Find</button>
    <select class="form-control" #nameSelect (change)="setItemDetailsNumber($event)">
      <option *ngFor="let itemName of itemNames" [value]="itemName.componentN">{{itemName.componentName}}</option>
    </select>
  </div>
    <div class="col-1">
      <button type="submit" class="btn btn-success">Go.</button>
    </div>
    <div class="col-1">
      <button type="button" class="btn btn-secondary" (click)="item = undefined">Clear</button>
    </div>

  </div>
</form>



<!--Item Movements Form-->
<div class="row mt-4 text-center">
  <h3 [ngClass]="setColors('title2')" (click)="showMovementsForm = !showMovementsForm" class="text-center mx-auto p-2">Item Movements</h3>
</div>
<form *ngIf="showMovementsForm" [formGroup]="itemMovementForm" (ngSubmit)="fetchMovements()">
  <div class="row border border-secondary rounded p-4 w-75 form-group mx-auto">
    <div class="col-1">
      <label>
        item type
      </label>
      <select formControlName="itemType" class="form-control">
        <option value="all">all</option>
        <option value="component">component</option>
        <option value="material">material</option>
        <option value="product">product</option>
      </select>
    </div>
    <div *ngIf="itemMovementForm.value.itemType == 'component'" class="col-2">
      <label>
        component type
      </label>
      <select formControlName="componentType" class="form-control">
        <option value="skip">Filter by Items</option>
        <option value='bottle_Glass'>בקבוק זכוכית</option>
        <option value='bottle_Plastic'>בקבוק פלסטיק</option>
        <option value='jar_Glass'>צנצנת זכוכית</option>
        <option value='jar_Plastic'>צנצנת פלסטיק</option>
        <option value='cap'>פקק</option>
        <option value='cover'>מכסה</option>
        <option value='pump'>משאבה</option>
        <option value='cosmetic_pump'>משאבה קוסמטית</option>
        <option value='over_cap'>מכסה עילי</option>
        <option value='tube'>שפורפרת</option>
        <option value='colons'>קולונים</option>
        <option value='hair_life'>היירלייפ</option>
        <option value='compacts'>קומפקטים</option>
        <option value='personal_package'>אריזות אישיות</option>
        <option value='master_carton'>קרטוני מאסטר</option>
        <option value='newsletter'>עלון לצרכן</option>
        <option value='irosol_valve'>אירוסול- שסתום</option>
        <option value='irosol_bottle'>איירוסול- בקבוק</option>
        <option value='irosol_hectotor'>אירוסול- הקטאטור</option>
        <option value='irosol_bottle'>איירוסול- בקבוק</option>
        <option value='cellophane'>צלופן</option>
        <option value='sticker'>מדבקה</option>
        <option value='sachet'>סאשט</option>
      </select>
    </div>
    <div class="col-2">
      <label>
        item numbers
      </label>
      <ng-container *ngFor="let item of itemMovementForm.value.itemNumbers; let i = index">
        <input (change)="setItemNumber(i, $event)" [value]="itemMovementForm.value.itemNumbers[i]" class="form-control"
          type="text">
        <button type="button" (click)="itemMovementForm.value.itemNumbers.push('')">+</button>
        <button *ngIf="i > 0" type="button" (click)="itemMovementForm.value.itemNumbers.pop()">-</button>
      </ng-container>
    </div>

    <div class="col-2">
      <label>from</label>
      <input formControlName="fromDate" class="form-control" type="date">
    </div>
    <div class="col-2">
      <label>to</label>
      <input formControlName="toDate" class="form-control" type="date">
    </div>
    <div class="col-1">
      <label>
        movement type
      </label>
      <select formControlName="movementType" class="form-control">
        <option value="all">all</option>
        <option value="in">in</option>
        <option value="out">out</option>
        <option value="production">production</option>
        <option value="shelfChange">Shelf Change</option>
      </select>
    </div>
    <div class="col-2">
      <label>
        amounts
      </label>
      <input formControlName="amount" class="form-control" type="number">
      <select formControlName="amountDir" class="form-control">
        <option value="higherThan">Higher than</option>
        <option value="lowerThan">Lower than</option>
      </select>
    </div>
    <div class="col-1">
      <button type="submit" class="btn btn-info">Go.</button>
    </div>
    <div class="col-1">
      <button type="button" class="btn btn-secondary" (click)="resetMovements()">Clear</button>
    </div>
  </div>
</form>


<!--Sold Products-->
<div class="row mt-4 text-center">
  <h3 [ngClass]="setColors('title3')" (click)="showSalesForm = !showSalesForm" class="text-center mx-auto p-2">Outgoing</h3>
</div>

<form *ngIf="showSalesForm" [formGroup]="productsSoldForm" (ngSubmit)="fetchProducts">
  <div class="row border border-warning rounded p-4 w-75 form-group mx-auto">
  <h4 class="text-warning">Coming soon...</h4>

    <!-- <div class="col-2">
      <label>Product Number</label>
      <input formControlName="productNumber" class="form-control" type="number">
    </div>
    <div class="col-2">
      <label>from</label>
      <input formControlName="fromDate" class="form-control" type="date">
    </div>
    <div class="col-2">
      <label>to</label>
      <input formControlName="toDate" class="form-control" type="date">
    </div>
    <div class="col-2">
      <label>
        amounts
      </label>
      <input formControlName="amount" class="form-control" type="number">
      <select formControlName="amountDir" class="form-control">
        <option value="higherThan">Higher than</option>
        <option value="lowerThan">Lower than</option>
      </select>
    </div>
    <div class="col-1">
      <button type="submit" class="btn btn-warning">Go.</button>
    </div>
    <div class="col-1">
      <button type="button" class="btn btn-secondary" (click)="resetMovements()">Clear</button>
    </div> -->
  </div>


</form>



<div class="row mt-2"></div>


<!--Item Details-->
<div *ngIf="item" class="bg-success p-5">

  <div class="border border-white p-2">

    <!--Name-->
    <div class=" row text-center">
      <div class="col-1"></div>
      <div class="col-8">
        <input class="form-control" type="text" [(ngModel)]="item.componentName">
      </div>
      <div class="col-2">
        <label class="form-control">שם פריט</label>
      </div>
      <div class="col-1"></div>
    </div>

    <!---->
    <div dir="rtl" class="row text-center ">
      <div class="col-4 ">
        <h5 class="text-white">פרטי פריט</h5>
      </div>
      <div class="col-4 ">
        <h5 class="text-white">פרטי ספק</h5>
      </div>
      <div class="col-4">
        <h5 class="text-white">פרטי מלאי</h5>
      </div>
    </div>

    <div dir="rtl" class="row text-center">
      <div class="col-2">
        <label class="form-control">מספר פריט</label>
        <label class="form-control">שם קומקס</label>
        <label class="form-control">פריט חלופי</label>
        <label class="form-control">מחיר אחרון (שקלים)</label>
        <label class="form-control">מחיר העמסה (שקלים)</label>
      </div>
      <div class="col-2">
        <input disabled (change)="checkIfItemExist($event)" class="form-control" type='text'
          [(ngModel)]="item.componentN">
        <input class="form-control mt-2" type="text" [(ngModel)]="item.comaxName">
        <input class="form-control mt-2" type="text" [(ngModel)]="item.alternativeComponent">
        <input class="form-control mt-2" type="text" [(ngModel)]="item.price">
        <input class="form-control mt-2" type="number" [(ngModel)]="item.shippingPrice">
      </div>
      <div class="col-2">
        <label class="form-control">מספר ספק</label>
        <label class="form-control">מק"ט ספק</label>
        <label class="form-control">מחיר ספק</label>
      </div>
      <div class="col-2">
        <input class="form-control" list="suppliers" type='text' (change)="fillSupplierDetails()"
          [(ngModel)]="item.suplierN">
        <datalist id="suppliers">
          <option *ngFor="let supplier of allSuppliers" value="{{supplier.suplierName}}">
            {{supplier.suplierNumber}}
          </option>
        </datalist>
        <input class="form-control mt-2" type='text' [(ngModel)]="item.componentNs">
        <input class="form-control mt-2" type='text' [(ngModel)]="item.price">
      </div>
      <div class="col-2">
        <label class="form-control">מלאי מינימום</label>
        <label class="form-control">כמות מינימלית להזמנה</label>
      </div>
      <div class="col-2">
        <input class="form-control" type='number' [(ngModel)]="item.minimumStock">
        <input class="form-control mt-2" type='number' [(ngModel)]="item.minimumPurchaseAmount">
      </div>
    </div>

    <div dir="rtl" class="row text-center">
      <div class="col-4">
        <h5 class="text-white">פרטים נוספים</h5>
      </div>
      <div class="col-4">
        <h5 class="text-white">הערות</h5>
      </div>
      <div class="col-4">
        <h5 class="text-white">תמונה</h5>
      </div>
    </div>

    <div dir="rtl" class="row text-center">

      <div class="col-2">
        <label class="form-control">קטגוריה</label>
        <label class="form-control">קטגוריה 2</label>
        <label class="form-control">קטגוריה 3</label>
        <label class="form-control">חומר</label>
        <label class="form-control">חומר 2</label>
        <label class="form-control">מותג</label>
        <label class="form-control">משקל/סוג</label>
        <label class="form-control">יח' מידה</label>
        <label class="form-control">כמות מל'</label>
        <label class="form-control">על חשבון</label>
        <label class="form-control">רשימת לקוחות</label>
      </div>

      <div class="col-2">
        <select class="form-control" [(ngModel)]="item.componentType">
          <option value=""></option>
          <option *ngFor="let cmptType of cmptTypes2">{{cmptType}}</option>
        </select>

        <select class="form-control mt-2" [(ngModel)]="item.componentType2">
          <option value=""></option>
          <option *ngFor="let cmptType of cmptTypes2">{{cmptType}}</option>
        </select>

        <select class="form-control mt-2" [(ngModel)]="item.componentType3">
          <option value=""></option>
          <option *ngFor="let cmptType of cmptTypes3">{{cmptType}}</option>
        </select>

        <select class="form-control mt-2" [(ngModel)]="item.componentMaterial">
          <option value=""></option>
          <option *ngFor="let cmptMaterial of cmptMaterials">{{cmptMaterial}}</option>
        </select>

        <select class="form-control mt-2" [(ngModel)]="item.componentMaterial2">
          <option value=""></option>
          <option *ngFor="let cmptMaterial of cmptMaterials2">{{cmptMaterial}}</option>
        </select>

        <select class="form-control mt-2" [(ngModel)]="item.componentCategory">
          <option value=""></option>
          <option *ngFor="let cmptCategory of cmptCategoryList">{{cmptCategory}}</option>
        </select>

        <select class="form-control mt-2" [(ngModel)]="item.packageType">
          <option value='paperCarton'>נייר/קרטון</option>
          <option value='drinkCarton'>קרטוניות משקה</option>
          <option value='transperentGlass'>זכוכית שקופה</option>
          <option value='colorGlass'>זכוכית צבעונית</option>
          <option value='pet'>PET</option>
          <option value='hdpe'>HDPE</option>
          <option value='ldpe'>LDPE</option>
          <option value='pp'>PP</option>
          <option value='ps'>PS</option>
          <option value='otherPlastic'>פלסטיק אחר</option>
          <option value='metal'>מתכת</option>
          <option value='wood'>עץ</option>
          <option value='otherMaterial'>חומר אחר</option>
        </select>

        <select class="form-control mt-2" [(ngModel)]="item.measurement">
          <option value="kilogram">kilogram</option>
          <option value="liter">liter</option>
          <option value="meter">meter</option>
          <option value="ml">ml</option>
          <option value="unit">Unit</option>
          <option value="ton">טון</option>
          <option value="unit">יחידה</option>
          <option value="box">קופסא</option>
        </select>

        <input class="form-control mt-2" type="text" [(ngModel)]="item.actualMlCapacity">
        <select class="form-control mt-2" [(ngModel)]="item.whoPays">
          <option value="peerpharm">פארפארם</option>
          <option value="customers">לקוח/לקוחות</option>
        </select>
      </div>

      <div class="col-2">
        <label class="form-control">הערה</label>
        <label class="form-control mt-5">הערה קופצת</label>
      
        <label class="form-control mt-4"> חומר בעייתי?</label>
        <input type="checkbox" class="problematic" [disabled]="!allowedProblematicEdit" [(ngModel)]="item.isProblematic" [ngModelOptions]="{standalone: true}">
        <label class="form-control mt-4">בעייתיות:</label>
        <select class="form-control" [(ngModel)]="item.problem">
          <option value="פג תוקף קצר">פג תוקף קצר</option>
          <option value="פריט ייבוא / זמן אספקה">פריט ייבוא / זמן אספקה</option>
          <option value="כמויות מינימום">כמויות מינימום</option>
          <option value="אחר">אחר</option>
        </select>
        

      </div>
      <div class="col-2">
        <textarea rows="2" cols="20" class="form-control" type='text' [(ngModel)]="item.remarks"></textarea>
        <textarea rows="2" cols="20" class="form-control mt-4" type='text' [(ngModel)]="item.jumpRemark"></textarea>
      
      </div>

    </div>

    <div class="row mt-2">
      <div class="col-2">
        <button [disabled]="gettingProducts" [style.cursor]="gettingProducts ? 'not-allowed' : 'pointer'"
          (click)="getProductsWithItem()">הצג מוצרים שמכילים את הפריט</button>
      </div>

      <div class="col-2 modal-inner border" *ngIf="item.connectedProducts">
        <div *ngFor="let product of item.connectedProducts">
          <h5>{{product.itemNumber}}</h5>
          <h5>{{product.name}}</h5>
          <h5>{{product.subName}}</h5>
          <h5>{{product.discriptionK}}</h5>
        </div>
      </div>
    </div>

    <div class="row text-center">
      <div class="col-12">
        <div *ngIf="allowUserEditItem">
          <button class="btn btn-success form-control" id="updateDataBtn" (click)="editStockItemDetails()">עדכן
            מידע</button>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <h2>Purchase History</h2>
  </div>
  <div class="row mt-4">
  </div>
  <div>
    <div class="smallLoader" *ngIf="fetchingOrders"></div>
    <div *ngIf="lastOrdersOfItem.length > 0" class="row text-center p-2">
      <h3>Purchase History for Item {{item.number}}</h3>
      <table class="table table-striped table-hover">
        <thead class="bg-success text-white">
          <tr>
            <th>#</th>
            <th>Order Number</th>
            <th>Supplier</th>
            <th>Status</th>
            <th>Order Date</th>
            <th>Arrival Date</th>
            <th>Arrived Amount</th>
            <th></th>
            <th>Ordered Amount</th>
            <th>Item Price (Foreign)</th>
            <th>Item Price (NIS)</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let lastorderitem of lastOrdersOfItem; let i = index">
            <tr>
              <td>{{i+1}}</td>
              <td>{{lastorderitem.orderNumber}}</td>
              <td>{{lastorderitem.supplierName}}</td>
              <td>{{lastorderitem.status}}</td>
              <td>{{lastorderitem.orderDate | date: 'dd/MM/yyyy'}}</td>
              <td><span *ngIf="lastorderitem.arrivalDate">{{lastorderitem.arrivalDate | date:
                  'dd/MM/yyyy'}}</span></td>
              <td>{{lastorderitem.arrivedAmount}}</td>
              <td>/</td>
              <td>{{lastorderitem.quantity}}</td>
              <td>{{lastorderitem.price | currency: lastorderitem.coin}}</td>
              <td>{{lastorderitem.localPrice | currency: 'ILS'}}</td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>


</div>






<div class="row mt-2">
</div>

<!--Item Movements-->
<div *ngIf="itemMovements" class="row mt-4 w-75 mx-auto">
  <table class="table table-hover">
    <thead class="text-info text-center">
      <tr>
        <th class="click text-center" (click)="sortBy('itemMovements', 'movementDate')">Date</th>
        <th class="click text-center" (click)="sortBy('itemMovements', 'movementType')">movement type</th>
        <th class="click text-center" (click)="sortBy('itemMovements', 'item')">item</th>
        <th></th>
        <th class="click text-center" (click)="sortBy('itemMovements', 'WH_originName')">whare house</th>
        <th class="click text-center" (click)="sortBy('itemMovements', 'amount')">in</th>
        <th class="click text-center" (click)="sortBy('itemMovements', 'amount')">out</th>
        <th class="click text-center" (click)="sortBy('itemMovements', 'amount')">production</th>
        <th class="click text-center" (click)="sortBy('itemMovements', 'amount')">shelf change</th>
        <th class="text-center" >user</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let movement of itemMovements">
        <td class="click click-td text-center" (click)="filter('movementDate', movement.movementDate)">
          {{movement.movementDate | date: 'dd/MM/yy'}}
        </td>
        <td class="click click-td text-center" (click)="filter('movementType', movement.movementType)">
          {{movement.movementType}}
        </td>
        <td class="click click-td text-center" (click)="filter('item', movement.item)">
          {{movement.item}}
        </td>
        <td class="click click-td text-center">{{movement.inventory_doc[0].componentName}}</td>
        <td class="click click-td text-center" (click)="filter('WH_originName', movement.WH_originName)">
          {{movement.WH_originName}}
        </td>
        <td class="click click-td text-center" (click)="filter('amount', movement.amount)">
          <span *ngIf="movement.movementType == 'in'">{{movement.amount}}</span>
        </td>
        <td class="click click-td text-center" (click)="filter('amount', movement.amount)">
          <span *ngIf="movement.movementType == 'out'">{{movement.amount}}</span>
        </td>
        <td class="click click-td text-center" (click)="filter('amount', movement.amount)">
          <span *ngIf="movement.movementType == 'production'">{{movement.amount}}</span>
        </td>
        <td class="click click-td text-center" (click)="filter('amount', movement.amount)">
          <span *ngIf="movement.movementType == 'shelfChange'">{{movement.amount}}</span>
        </td>
        <td class="click click-td text-center" (click)="filter('userName', movement.userName)">
          {{movement.userName}}
        </td>
      </tr>
    </tbody>
  </table>
</div>





