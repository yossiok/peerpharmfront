<div style="margin:1em">
  <label class="board-label">To Do!</label>
  <a [routerLink]="['/subcard']">sub card</a>
  <mat-form-field style="float:right">
    <input matInput placeholder="Search Tasks" type="search" [(ngModel)]="taskFilter.name" />
  </mat-form-field>
</div>

<div>
  <mat-grid-list cols="4" style="margin:8px;" gutterSize="20px">
    <mat-grid-tile class="board-list" *ngFor="let tile of tiles" [colspan]="tile.cols" [rowspan]="tile.rows" [style.background]="tile.color"
      dnd-droppable (onDropSuccess)="simpleDrop($event, tile.text, tile.boardid)">
      <mat-grid-tile-header class="board-list-header" [style.background]="tile.titlecolor">
        <span class="list-header-text">{{tile.text}}</span>
        <button mat-icon-button [matMenuTriggerFor]="menu" matTooltip="Sort">
          <mat-icon>sort</mat-icon>
        </button>
        <button mat-icon-button matTooltip="Add new task" (click)="showAddtask(tile.text)" *ngIf="tile.text !== 'Done'">
          <mat-icon *ngIf="tile.add === false">add</mat-icon>
          <mat-icon *ngIf="tile.add === true">remove</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="sortByDate(tile.text)">
            <mat-icon style="color: black">update</mat-icon>
            <span>Due date</span>
          </button>
          <button mat-menu-item (click)="sortByPriority(tile.text)">
            <mat-icon style="color: red">priority_high</mat-icon>
            <span>Priority</span>
          </button>
        </mat-menu>
      </mat-grid-tile-header>
      <div class="task-card">
        <div class="new-task-card" *ngIf="tile.add === true">

          <form #newTaskForm="ngForm">
            <mat-form-field style="width: 75px">
              <input matInput placeholder="Priority" type="number" name="priority" [(ngModel)]="data.priority" min=1 max=50 required />
            </mat-form-field>
            <!-- <material-datepicker class="duedate" placeholder="Due Date" [(date)]="data.duedate" name="duedate" dateFormat="DD-MM-YYYY"></material-datepicker> -->
            <mat-form-field>
              <input matInput [matDatepicker]="picker" placeholder="Due date" [(ngModel)]="data.duedate" name="duedate" />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
            <div class="error" [hidden]="data.duedate !== ''">Due date required</div>
            <mat-form-field class="example-full-width">
              <input matInput placeholder="Description" name="description" [(ngModel)]="data.description" maxlength="75" required/>
            </mat-form-field>


            <button mat-raised-button [disabled]="!newTaskForm.form.valid" (click)="addNewTask(tile.text)">Create</button>

          </form>
        </div>
        <app-board-task-card *ngFor="let task of tasks | filterBy: taskFilter; let i = index" [tileName]="tile.text" [task]="task"
          (click)='showTaskDetails(task._id,content,i)'></app-board-task-card>

      </div>


      <div *ngIf="newTaskId">
        <form #newTaskForm="ngForm">
          <div *ngIf="getNewTaskId">
            <mat-form-field>
              <input matInput placeholder="Department" name="mainTaskId" [(ngModel)]="subData.mainTaskId" maxlength="75" required [value]="getNewTaskId"
              />
            </mat-form-field>
          </div>
          <mat-form-field style="width: 75px">
            <input matInput placeholder="Priority" type="number" name="priority" [(ngModel)]="subData.priority" min=1 max=50 required
            />
          </mat-form-field>
          <!-- <material-datepicker class="duedate" placeholder="Due Date" [(date)]="subData.duedate" name="duedate" dateFormat="DD-MM-YYYY"></material-datepicker> -->
          <mat-form-field>
            <input matInput [matDatepicker]="picker" placeholder="Due date" [(ngModel)]="subData.dueDate" name="duedate" />
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
          <div class="error" [hidden]="data.duedate !== ''">Due date required</div>
          <mat-form-field>
            <input matInput placeholder="Description" name="description" [(ngModel)]="subData.name" maxlength="275" required/>
          </mat-form-field>
          <br>
          <mat-form-field>
            <input matInput placeholder="Department" name="dep" [(ngModel)]="subData.depId" maxlength="75" required/>
          </mat-form-field>
          <br>
          <mat-form-field>
            <mat-select placeholder="Department" maxlength="75" (change)="shome($event);" required>
              <mat-option *ngFor="let dep of departemnts" [value]="dep._id">
                {{dep.title}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field>
            <input matInput placeholder="User" name="user" [(ngModel)]="subData.userId" maxlength="75" required/>
          </mat-form-field>
          <br>

          <button (click)="addNewSubTask(getNewTaskId)">Add</button>
          <br>
        </form>
      </div>
    </mat-grid-tile>
  </mat-grid-list>

  <ng-template #content let-c="close" let-d="dismiss">
    <div class="modal-header">
      <h4 class="modal-title">{{modalTitle}}</h4>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div *ngFor="let sb of subTasksArr">

        <mat-card class="card">
          <span class="card-desc">{{sb.name}}</span>
          <mat-card-subtitle>Due date: {{ sb.dueDate }}</mat-card-subtitle>
          <mat-card-subtitle>Departments: {{ sb.departments }}</mat-card-subtitle>
          <mat-card-subtitle>Status {{ sb.status }}</mat-card-subtitle> 
        </mat-card>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="c('Close click')">Close</button>
    </div>
  </ng-template>



  <!-- New task window -->
